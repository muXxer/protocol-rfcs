<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>TIP-20 Transaction Payload with TIP-18 Output Types - The Tangle Improvement Proposal (TIP) Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0001/tip-0001.html">TIP-1 TIP Process</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0002/tip-0002.html">TIP-2 White Flag Ordering</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0003/tip-0003.html">TIP-3 Uniform Random Tip Selection</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0004/tip-0004.html">TIP-4 Milestone Merkle Validation</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0005/tip-0005.html">TIP-5 Binary To Ternary Encoding</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0006/tip-0006.html">TIP-6 Tangle Message</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0007/tip-0007.html">TIP-7 Transaction Payload</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0008/tip-0008.html">TIP-8 Milestone Payload</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0009/tip-0009.html">TIP-9 Local Snapshot File Format</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0010/tip-0010.html">TIP-10 Mnemonic Ternary Seed</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0011/tip-0011.html">TIP-11 Bech32 Address Format</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0012/tip-0012.html">TIP-12 Message PoW</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0013/tip-0013.html">TIP-13 REST API</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0014/tip-0014.html">TIP-14 Ed25519 Validation</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0015/tip-0015.html">TIP-15 Dust Protection</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0016/tip-0016.html">TIP-16 Event API</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0017/tip-0017.html">TIP-17 Wotsicide</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0018/tip-0018.html">TIP-18 Multi-Asset Ledger and ISC Support</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0019/tip-0019.html">TIP-19 Dust Protection Based on Byte Costs (Storage Deposit)</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0020/tip-0020.html" class="active">TIP-20 Transaction Payload with TIP-18 Output Types</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0021/tip-0021.html">TIP-21 Serialization Primitives</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0022/tip-0022.html">TIP-22 IOTA Protocol Parameters</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0023/tip-0023.html">TIP-23 Tagged Data Payload</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0024/tip-0024.html">TIP-24 Tangle Block</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0025/tip-0025.html">TIP-25 Core REST API</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0026/tip-0026.html">TIP-26 UTXO Indexer API</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0027/tip-0027.html">TIP-27 IOTA NFT Standard IRC27</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0028/tip-0028.html">TIP-28 Event API</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0029/tip-0029.html">TIP-29 Milestone Payload</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0030/tip-0030.html">TIP-30 Native Token Metadata JSON Schema</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0031/tip-0031.html">TIP-31 Bech32 Address Format</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0032/tip-0032.html">TIP-32 Shimmer Protocol Parameters</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0034/tip-0034.html">TIP-34 Wotsicide (Stardust)</a></li><li class="chapter-item expanded "><a href="../../tips/TIP-0035/tip-0035.html">TIP-35 Local Snapshot File Format</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Tangle Improvement Proposal (TIP) Book</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <pre>
tip: 20
title: Transaction Payload with TIP-18 Output Types
description: Add output types, unlocks, and output features from TIP-18 into Transaction Payload
author: Levente Pap (@lzpap) <levente.pap@iota.org>
discussions-to: https://github.com/iotaledger/tips/pull/40
status: Active
type: Standards
layer: Core
created: 2021-11-18
requires: 18
replaces: 7
</pre>
<h1 id="summary"><a class="header" href="#summary">Summary</a></h1>
<p>This TIP proposes a UTXO-based transaction structure consisting of all the inputs and outputs of a transfer. Specifically, this TIP defines a transaction payload for <em>blocks</em> described in <a href="../TIP-0024/tip-0024.html">TIP-24</a> and extends the transaction payload described in <a href="../TIP-0007/tip-0007.html">TIP-7</a>.</p>
<h1 id="motivation"><a class="header" href="#motivation">Motivation</a></h1>
<p><a href="../TIP-0007/tip-0007.html">TIP-7</a> describes the introduction of the UTXO ledger model for Chrysalis. This TIP extends the
transaction model of the UTXO ledger to:</p>
<ul>
<li>accommodate for the new output types introduced in <a href="../TIP-0018/tip-0018.html">TIP-18</a>,</li>
<li>include a <em>Network ID</em> field in the transaction for replay protection,</li>
<li>introduce <em>Inputs Commitment</em> field to prevent client <a href="https://github.com/iotaledger/tips/discussions/51">eclipse attacks that would result in loss of funds,</a></li>
<li>relax syntactic validation rules such that inputs and outputs of a transaction are no longer lexicographically ordered, furthermore
outputs do not have to be unique.</li>
</ul>
<p>The motivation for such changes is to provide a more flexible and secure framework for wallets and layer 2 applications. Chrysalis
focused solely on using the ledger as a payment application, while Stardust transforms the ledger into a settlement layer
for interconnected layer 2 blockchains and applications.</p>
<h1 id="detailed-design"><a class="header" href="#detailed-design">Detailed design</a></h1>
<h2 id="utxo"><a class="header" href="#utxo">UTXO</a></h2>
<p>The <em>unspent transaction output</em> (UTXO) model defines a ledger state where balances are not directly associated to addresses but to the outputs of transactions. In this model, transactions reference outputs of previous transactions as inputs, which are consumed (removed) to create new outputs. A transaction must consume all the funds of the referenced inputs.</p>
<p>Using a UTXO-based model provides several benefits:</p>
<ul>
<li>Parallel validation of transactions.</li>
<li>Easier double-spend detection, since conflicting transactions would reference the same UTXO.</li>
<li>Replay-protection which is important when having reusable addresses. Replaying the same transaction would manifest itself as already being applied or existent and thus not have any impact.</li>
<li>Balances are no longer strictly associated to addresses. This allows a higher level of abstraction and thus enables other types of outputs with particular unlock criteria.</li>
</ul>
<p>Within a transaction using UTXOs, inputs and outputs make up the to-be-signed data of the transaction. The section unlocking the inputs is called the <em>unlock</em>. An unlock may contain a signature proving ownership of a given input's address and/or other unlock criteria.</p>
<p>The following image depicts the flow of funds using UTXO:</p>
<p><img src="utxo.png" alt="UTXO flow" /></p>
<h2 id="structure"><a class="header" href="#structure">Structure</a></h2>
<h3 id="serialized-layout"><a class="header" href="#serialized-layout">Serialized layout</a></h3>
<p>A <em>Transaction Payload</em> is made up of two parts:</p>
<ol>
<li>The <em>Transaction Essence</em> part which contains the inputs, outputs and an optional embedded payload.</li>
<li>The <em>Unlocks</em> which unlock the inputs of the <em>Transaction Essence</em>.</li>
</ol>
<p>The serialized form of the transaction is deterministic, meaning the same logical transaction always results in the same serialized byte sequence. However, in contrast to Chrysalis Phase 2 <a href="../TIP-0007/tip-0007.html">TIP-7</a> the inputs and outputs are considered as lists. They can contain duplicates and their serialization order matches the order of the list; they do not need to be sorted.</p>
<p>The <em>Transaction Payload ID</em> is the <a href="https://tools.ietf.org/html/rfc7693">BLAKE2b-256</a> hash of the entire serialized payload data including unlocks.</p>
<p>The following table describes the entirety of a <em>Transaction Payload</em> in its serialized form following the notation from <a href="../TIP-0021/tip-0021.html">TIP-21</a>:</p>
<table>
  <tr>
    <th>Name</th>
    <th>Type</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>Payload Type</td>
    <td>uint32</td>
    <td>
      Set to <strong>value 6</strong> to denote a <i>TIP-20 Transaction Payload</i>.
    </td>
  </tr>
  <tr>
    <td valign="top">Essence <code>oneOf</code></td>
    <td colspan="2">
      <details open="true">
        <summary>Transaction Essence</summary>
        <blockquote>
          Describes the essence data making up a transaction by defining its inputs, outputs and an optional payload.
        </blockquote>
        <table>
          <tr>
            <td><b>Name</b></td>
            <td><b>Type</b></td>
            <td><b>Description</b></td>
          </tr>
          <tr>
            <td>Transaction Type</td>
            <td>uint8</td>
            <td>
              Set to <strong>value 1</strong> to denote a <i>TIP-20 Transaction Essence</i>.
            </td>
          </tr>
          <tr>
            <td>Network ID</td>
            <td>uint64</td>
            <td>
              The unique value denoting whether the block was meant for mainnet, shimmer, testnet, or a private network. It consists of the first 8 bytes of the BLAKE2b-256 hash of the network name.
            </td>
          </tr>
          <tr>
            <td>Inputs Count</td>
            <td>uint16</td>
            <td>The number of input entries.</td>
          </tr>
          <tr>
            <td valign="top">Inputs <code>anyOf</code></td>
            <td colspan="2">
              <details>
                <summary>UTXO Input</summary>
                <blockquote>
                  Describes an input which references an unspent transaction output to consume.
                </blockquote>
                <table>
                  <tr>
                    <td><b>Name</b></td>
                    <td><b>Type</b></td>
                    <td><b>Description</b></td>
                  </tr>
                  <tr>
                    <td>Input Type</td>
                    <td>uint8</td>
                    <td>
                      Set to <strong>value 0</strong> to denote an <i>TIP-20 UTXO Input</i>.
                    </td>
                  </tr>
                  <tr>
                    <td>Transaction ID</td>
                    <td>ByteArray[32]</td>
                    <td>The BLAKE2b-256 hash of the transaction payload containing the referenced output.</td>
                  </tr>
                  <tr>
                    <td>Transaction Output Index</td>
                    <td>uint16</td>
                    <td>The output index of the referenced output.</td>
                  </tr>
                </table>
              </details>
            </td>
          </tr>
          <tr>
            <td>Inputs Commitment</td>
            <td>ByteArray[32]</td>
            <td>
              BLAKE2b-256 hash serving as a commitment to the serialized outputs referenced by <code>Inputs</code>.
            </td>
          </tr>
          <tr>
            <td>Outputs Count</td>
            <td>uint16</td>
            <td>The number of output entries.</td>
          </tr>
          <tr>
            <td valign="top">Outputs <code>anyOf</code></td>
            <td colspan="2">
              <details>
                <summary>Basic Output</summary>
                <blockquote>
                  Describes a deposit to a single address. The output might contain optional features and native tokens.
                </blockquote>
              </details>
              <details>
                <summary>Alias Output</summary>
                <blockquote>
                  Describes an alias account in the ledger.
                </blockquote>
              </details>
              <details>
                <summary>Foundry Output</summary>
                <blockquote>
                  Describes a foundry that controls supply of native tokens.
                </blockquote>
              </details>
              <details>
                <summary>NFT Output</summary>
                <blockquote>
                  Describes a unique, non-fungible token deposit to a single address.
                </blockquote>
              </details>
            </td>
          </tr>
          <tr>
            <td>Payload Length</td>
            <td>uint32</td>
            <td>The length in bytes of the optional payload.</td>
          </tr>
          <tr>
            <td valign="top">Payload <code>optOneOf</code></td>
            <td colspan="2">
              <details>
                <summary>Tagged Data Payload</summary>
                <blockquote>
                  Describes data with optional tag, defined in TIP-23.
                </blockquote>
              </details>
            </td>
          </tr>
        </table>
      </details>
    </td>
  </tr>
  <tr>
    <td>Unlocks Count</td>
    <td>uint16</td>
    <td>The number of unlock entries. It must match the field <code>Inputs Count</code>.</td>
  </tr>
  <tr>
    <td valign="top">Unlocks <code>anyOf</code></td>
    <td colspan="2">
      <details>
        <summary>Signature Unlock</summary>
        <blockquote>
          Defines an unlock containing a signature.
        </blockquote>
      </details>
      <details>
        <summary>Reference Unlock</summary>
        <blockquote>
          References a previous unlock, where the same unlock can be used for multiple inputs.
        </blockquote>
      </details>
      <details>
        <summary>Alias Unlock</summary>
        <blockquote>
          References a previous unlock of a consumed alias output.
        </blockquote>
      </details>
      <details>
        <summary>NFT Unlock</summary>
        <blockquote>
          References a previous unlock of a consumed NFT output.
        </blockquote>
      </details>
    </td>
  </tr>
</table>
<h3 id="transaction-essence"><a class="header" href="#transaction-essence">Transaction Essence</a></h3>
<p>The <i>Transaction Essence</i> of a <i>Transaction Payload</i> carries the inputs, outputs, and an optional payload. The <i>Transaction Essence</i> is an explicit type and therefore starts with its own <i>Transaction Essence Type</i> byte which is of value 1 for <i>TIP-20 Transaction Essence</i>.</p>
<h4 id="network-id"><a class="header" href="#network-id">Network ID</a></h4>
<p>The <code>Network ID</code> field of the transaction essence serves as a <a href="https://github.com/iotaledger/tips/discussions/56">replay protection mechanism</a>.
It is a unique value denoting whether the transaction was meant for the IOTA mainnet, shimmer, testnet-1, or a private network. It consists of the first 8 bytes of the BLAKE2b-256 hash of the <code>Network Name</code> protocol parameter, interpreted as an unsigned integer number.</p>
<div class="table-wrapper"><table><thead><tr><th>Network Name</th><th>Resulting <code>Network ID</code></th><th>Network Name defined in</th></tr></thead><tbody>
<tr><td><code>iota-mainnet</code></td><td><code>9374574019616453254</code></td><td><a href="../TIP-0022/tip-0022.html#detailed-design">TIP-22</a></td></tr>
<tr><td><code>shimmer</code></td><td><code>14364762045254553490</code></td><td><a href="../TIP-0032/tip-0032.html#global-parameters">TIP-32</a></td></tr>
<tr><td><code>testnet-1</code></td><td><code>1856588631910923207</code></td><td>-</td></tr>
<tr><td><code>example-mynetwork</code></td><td><code>1967754805504104511</code></td><td>-</td></tr>
</tbody></table>
</div>
<h4 id="inputs"><a class="header" href="#inputs">Inputs</a></h4>
<p>The <code>Inputs</code> field holds the inputs to consume in order to fund the outputs of the <i>Transaction Payload</i>. Currently, there is only one type of input, the <i>UTXO Input</i>. In the future, more types of inputs may be specified as part of protocol upgrades.</p>
<p>Each input must be accompanied by a corresponding <i>Unlock</i> at the same index in the <i>Unlocks</i> part of the <i>Transaction Payload</i>.</p>
<h5 id="utxo-input"><a class="header" href="#utxo-input">UTXO Input</a></h5>
<p>A <i>UTXO Input</i> is an input which references an unspent output of a previous transaction. This UTXO is uniquely identified by its <em>Output ID</em>, defined by the <em>Transaction ID</em> of the creating transaction together with corresponding output index. Each <i>UTXO Input</i> must be accompanied by an <i>Unlock</i> that is allowed to unlock the referenced output.</p>
<h4 id="inputs-commitment"><a class="header" href="#inputs-commitment">Inputs Commitment</a></h4>
<p>The <code>Inputs Commitment</code> field of the <em>Transaction Essence</em> is a cryptographic commitment to the content of the consumed outputs (inputs). It consists of the BLAKE2b-256 hash of the concatenated output hashes.</p>
<p>In the <code>Inputs</code> field, they are only referenced by  <em>Output ID</em>. While the <em>Output ID</em> technically depends on the content of the actual output, a client has no way of validating this without access to the original transaction. For the <code>Inputs Commitment</code>, the client has to be aware of the outputs’ content in order to produce a semantically valid transaction. This protects clients against <a href="https://github.com/iotaledger/tips/discussions/51">eclipse attacks that would result in loss of funds</a>.</p>
<h4 id="outputs"><a class="header" href="#outputs">Outputs</a></h4>
<p>The <code>Outputs</code> field holds the outputs that are created by the <i>Transaction Payload</i>. There are different output types, but they must all have an <code>Amount</code> field denoting the number of IOTA coins to deposit.</p>
<p>The following table lists all the output types that are currently supported as well as links to the corresponding specification. The <em>SigLockedSingleOutput</em> as well as the <em>SigLockedDustAllowanceOutput</em> introduced in Chrysalis Phase 2 <a href="../TIP-0007/tip-0007.html">TIP-7</a> have been removed and are no longer supported.</p>
<div class="table-wrapper"><table><thead><tr><th>Output Name</th><th>Type Value</th><th>TIP</th></tr></thead><tbody>
<tr><td>Basic</td><td>3</td><td><a href="../TIP-0018/tip-0018.html#basic-output">TIP-18</a></td></tr>
<tr><td>Alias</td><td>4</td><td><a href="../TIP-0018/tip-0018.html#alias-output">TIP-18</a></td></tr>
<tr><td>Foundry</td><td>5</td><td><a href="../TIP-0018/tip-0018.html#foundry-output">TIP-18</a></td></tr>
<tr><td>NFT</td><td>6</td><td><a href="../TIP-0018/tip-0018.html#nft-output">TIP-18</a></td></tr>
</tbody></table>
</div>
<h4 id="payload"><a class="header" href="#payload">Payload</a></h4>
<p>The  <em>Transaction Essence</em> itself can contain another payload as described in general in  <a href="../TIP-0024/tip-0024.html">TIP-24</a>. The <a href="#semantic-validation">semantic validity</a> of the encapsulating <em>Transaction Payload</em> does not have any impact on the payload.</p>
<p>The following table lists all the payload types that can be nested inside a <em>Transaction Essence</em> as well as links to the corresponding specification:</p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type Value</th><th>TIP</th></tr></thead><tbody>
<tr><td>Tagged Data</td><td>5</td><td><a href="../TIP-0023/tip-0023.html">TIP-23</a></td></tr>
</tbody></table>
</div>
<h3 id="unlocks"><a class="header" href="#unlocks">Unlocks</a></h3>
<p>The <code>Unlocks</code> field holds the unlocks unlocking inputs within a <em>Transaction Essence</em>.</p>
<p>The following table lists all the output types that are currently supported as well as links to the corresponding specification. The <em>Signature Unlock</em> and the <em>Reference Unlock</em> are specified as part of this TIP.</p>
<div class="table-wrapper"><table><thead><tr><th>Unlock Name</th><th>Type Value</th><th>TIP</th></tr></thead><tbody>
<tr><td>Signature</td><td>0</td><td><a href="#signature-unlock">TIP-20</a></td></tr>
<tr><td>Reference</td><td>1</td><td><a href="#reference-unlock">TIP-20</a></td></tr>
<tr><td>Alias</td><td>2</td><td><a href="../TIP-0018/tip-0018.html#alias-locking--unlocking">TIP-18</a></td></tr>
<tr><td>NFT</td><td>3</td><td><a href="../TIP-0018/tip-0018.html#nft-locking--unlocking">TIP-18</a></td></tr>
</tbody></table>
</div>
<h4 id="signature-unlock"><a class="header" href="#signature-unlock">Signature Unlock</a></h4>
<p>The <i>Signature Unlock</i> defines an <i>Unlock</i> which holds a signature signing the BLAKE2b-256 hash of the <i>Transaction Essence</i> (including the optional payload). It is serialized as follows:</p>
<table>
  <tr>
    <th>Name</th>
    <th>Type</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>Unlock Type</td>
    <td>uint8</td>
    <td>
      Set to <strong>value 0</strong> to denote a <i>Signature Unlock</i>.
    </td>
  </tr>
  <tr>
    <td valign="top">Signature <code>oneOf</code></td>
    <td colspan="2">
      <details>
        <summary>Ed25519 Signature</summary>
        <table>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
          <tr>
            <td>Signature Type</td>
            <td>uint8</td>
            <td>
              Set to <strong>value 0</strong> to denote an <i>Ed25519 Signature</i>.
            </td>
          </tr>
          <tr>
            <td>Public key</td>
            <td>ByteArray[32]</td>
            <td>The Ed25519 public key of the signature.</td>
          </tr>
          <tr>
            <td>Signature</td>
            <td>ByteArray[64]</td>
            <td>The Ed25519 signature signing the Blake2b-256 hash of the serialized <i>Transaction Essence</i>.</td>
          </tr>
        </table>
      </details>
    </td>
  </tr>
</table>
<h5 id="unlock-syntactic-validation"><a class="header" href="#unlock-syntactic-validation">Unlock syntactic validation</a></h5>
<ul>
<li><code>Signature</code> must contain an <em>Ed25519 Signature</em>.</li>
<li>The <em>Signature Unlock</em> must be unique, i.e. there must not be any other <em>Signature Unlocks</em> in the <code>Unlocks</code> field of the transaction payload with the same signature.</li>
</ul>
<h4 id="reference-unlock"><a class="header" href="#reference-unlock">Reference Unlock</a></h4>
<p>The <i>Reference Unlock</i> defines an <i>Unlock</i> which references a previous <i>Unlock</i> (which must not be another <i>Reference Unlock</i>). It <strong>must</strong> be used if multiple inputs can be unlocked via the same <i>Unlock</i>. It is serialized as follows:</p>
<table>
  <tr>
    <th>Name</th>
    <th>Type</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>Unlock Type</td>
    <td>uint8</td>
    <td>
      Set to <strong>value 1</strong> to denote a <i>Reference Unlock</i>.
    </td>
  </tr>
  <tr>
    <td>Reference</td>
    <td>uint16</td>
    <td>Represents the index of a previous unlock.</td>
  </tr>
</table>
<h5 id="unlock-syntactic-validation-1"><a class="header" href="#unlock-syntactic-validation-1">Unlock syntactic validation</a></h5>
<ul>
<li>The <em>Reference Unlock</em> at index i must have <code>Reference</code> &lt; i and the unlock at index <code>Reference</code> must be a <em>Signature Unlock</em>.</li>
</ul>
<p>Example:
Consider a <i>Transaction Essence</i> containing the <i>UTXO Inputs</i> 0, 1 and 2, where 0 and 2 are both spending outputs belonging to the same Ed25519 address A and 1 is spending from a different address B. This results in the following structure of the <i>Unlocks</i> part:</p>
<div class="table-wrapper"><table><thead><tr><th>Index</th><th>Unlock</th></tr></thead><tbody>
<tr><td>0</td><td>A <em>Signature Unlock</em> holding the Ed25519 signature for address A.</td></tr>
<tr><td>1</td><td>A <em>Signature Unlock</em> holding the Ed25519 signature for address B.</td></tr>
<tr><td>2</td><td>A <em>Reference Unlock</em> which references 0, as both require the same signature for A.</td></tr>
</tbody></table>
</div>
<h2 id="validation"><a class="header" href="#validation">Validation</a></h2>
<p>A <i>Transaction Payload</i> has different validation stages, since some validation steps can only be executed when certain information has (or has not) been received. We therefore distinguish between syntactic and semantic validation.</p>
<p>The different output types and optional output features introduced by <a href="../TIP-0018/tip-0018.html">TIP-18</a> add additional constraints to the transaction validation rules, but since these are specific to the given outputs and features, they are discussed for each <a href="../TIP-0018/tip-0018.html#output-design">output type</a> and <a href="../TIP-0018/tip-0018.html#features">feature type</a> separately.</p>
<h3 id="syntactic-validation"><a class="header" href="#syntactic-validation">Syntactic validation</a></h3>
<p>Syntactic validation is checked as soon as the transaction has been received. It validates the structure but not the signatures of the transaction. If the transaction does not pass this stage, it must not be broadcast further and can be discarded right away.</p>
<p>The following criteria defines whether a payload passes the syntactical validation:</p>
<ul>
<li>Essence:
<ul>
<li><code>Transaction Type</code> value must denote a <em>TIP-20 Transaction Essence</em>.</li>
<li><code>Network ID</code> must match the value of the current network.</li>
<li>Inputs:
<ul>
<li><code>Inputs Count</code> must be 0 &lt; x ≤ <code>Max Inputs Count</code>.</li>
<li>For each input the following must be true:
<ul>
<li><code>Input Type</code> must denote a <em>UTXO Input</em>.</li>
<li><code>Transaction Output Index</code> must be 0 ≤ x &lt; <code>Max Outputs Count</code>.</li>
</ul>
</li>
<li>Each pair of <code>Transaction ID</code> and <code>Transaction Output Index</code> must be unique in the list of inputs.</li>
</ul>
</li>
<li>Outputs:
<ul>
<li><code>Outputs Count</code> must be 0 &lt; x ≤ <code>Max Outputs Count</code>.</li>
<li>For each output the following must be true:
<ul>
<li><code>Output Type</code> must match one of the values described under <a href="#outputs">Outputs</a>.</li>
<li>The output itself must pass syntactic validation.</li>
</ul>
</li>
<li>The sum of all <code>Amount</code> fields must not exceed <code>Max IOTA Supply</code>.</li>
<li>The count of all distinct native tokens present in outputs must not be larger than <code>Max Native Token Count</code>.</li>
</ul>
</li>
<li>Payload (if present):
<ul>
<li><code>Payload Type</code> must match one of the values described under <a href="#payload">Payload</a>.</li>
<li>Payload fields must be correctly parsable in the context of the <code>Payload Type</code>.</li>
<li>The payload itself must pass syntactic validation.</li>
</ul>
</li>
</ul>
</li>
<li>Unlocks:
<ul>
<li><code>Unlocks Count</code> must match <code>Inputs Count</code> of the <em>Transaction Essence</em>.</li>
<li>For each unlock the following must be true:
<ul>
<li>Each <code>Unlock Type</code> must match one of the values described under <a href="#unlocks">Unlocks</a>.</li>
<li>The unlock itself must pass syntactic validation.</li>
</ul>
</li>
</ul>
</li>
<li>Given the type and length information, the <em>Transaction Payload</em> must consume the entire byte array of the <code>Payload</code> field of the encapsulating object.</li>
</ul>
<h3 id="semantic-validation"><a class="header" href="#semantic-validation">Semantic validation</a></h3>
<p>The Semantic validation of a <em>Transaction Payload</em> is performed when its encapsulating block is confirmed by a milestone. The semantic validity of transactions depends on the order in which they are processed. Thus, it is necessary that all the nodes in the network perform the checks in the same order, no matter the order in which the transactions are received. This is assured by using the White-Flag ordering as described in  <a href="../TIP-0002/tip-0002.html#deterministically-ordering-the-tangle">TIP-2</a>.</p>
<p>Processing transactions according to the White-Flag ordering enables users to spend UTXOs which are created in the same milestone confirmation cone, as long as the spending transaction comes after the funding transaction in the aforementioned White-Flag order. In this case, it is recommended that users include the <em>Block ID</em> of the funding transaction as a parent of the block containing the spending transaction.</p>
<p>The following criteria defines whether a payload passes the semantic validation:</p>
<ul>
<li>Each input must reference a valid UTXO, i.e. the output referenced by the input's <code>Transaction ID</code> and <code>Transaction Output Index</code> is known (booked) and unspent.</li>
<li><code>Inputs Commitment</code> must equal BLAKE2( BLAKE2(O<sub>1</sub>) || … || BLAKE2(O<sub>n</sub>) ), where O<sub>1</sub>, ..., O<sub>n</sub> are the complete serialized outputs referenced by the <code>Inputs</code> field in that order.</li>
<li>The transaction must spend the entire coin balance, i.e. the sum of the <code>Amount</code> fields of all the UTXOs referenced by inputs must match the sum of the <code>Amount</code> fields of all outputs.</li>
<li>The count of all distinct native tokens present in the UTXOs referenced by inputs and in the transaction outputs must not be larger than <code>Max Native Token Count</code>. A native token that occurs several times in both inputs and outputs is counted as one.</li>
<li>The transaction is balanced in terms of native tokens, when the amount of native tokens present in all the UTXOs referenced by inputs equals to that of outputs. When the transaction is imbalanced, it must hold true that when there is a <strong>surplus of native tokens</strong> on the:
<ul>
<li><strong>output side of the transaction:</strong> the foundry outputs controlling outstanding native token balances must be present in the transaction. The validation of the foundry output(s) determines if the minting operations are valid.</li>
<li><strong>input side of the transaction:</strong> the transaction destroys tokens. The presence and validation of the foundry outputs of the native tokens determines whether the tokens are burned (removed from the ledger) or melted within the foundry. When the foundry output is not present in the transaction, outstanding token balances must be burned.</li>
</ul>
</li>
<li>Each output and all its <a href="../TIP-0018/tip-0018.html#features">output features</a> must pass semantic validation in the context of the following input:
<ol>
<li>The <em>Transaction Payload</em>,</li>
<li>the list of UTXOs referenced by inputs and</li>
<li>the Unix timestamp of the confirming milestone.</li>
</ol>
</li>
<li>Each unlock must be valid with respect to the UTXO referenced by the input of the same index:
<ul>
<li>If it is a <em>Signature Unlock</em>:
<ul>
<li>The <code>Signature Type</code> must match the <code>Address Type</code> of the UTXO, </li>
<li>the BLAKE2b-256 hash of <code>Public Key</code> must match the <code>Address</code> of the UTXO and</li>
<li>the <code>Signature</code> field must contain a valid signature for <code>Public Key</code>.</li>
</ul>
</li>
<li>If it is a <em>Reference Unlock</em>, the referenced <em>Signature Unlock</em> must be valid with respect to the UTXO.</li>
<li>If it is an <em>Alias Unlock</em>:
<ul>
<li>The address unlocking the UTXO must be an <em>Alias Address</em>.</li>
<li>The referenced <em>Unlock</em> unlocks the alias defined by the unlocking address of the UTXO.</li>
</ul>
</li>
<li>If it is an <em>NFT Unlock</em>:
<ul>
<li>The address unlocking the UTXO must be a <em>NFT Address</em>.</li>
<li>The referenced <em>Unlock</em> unlocks the NFT defined by the unlocking address of the UTXO.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>If a <em>Transaction Payload</em> passes the semantic validation, its referenced UTXOs must be marked as spent and its new outputs must be created/booked in the ledger. The <em>Block ID</em> of the block encapsulating the processed payload then also becomes part of the input for the White-Flag Merkle tree hash of the confirming milestone (<a href="../TIP-0004/tip-0004.html">TIP-4</a>).</p>
<p>Transactions that do not pass semantic validation are ignored. Their UTXOs are not marked as spent and their outputs are not booked in the ledger.</p>
<h2 id="miscellaneous"><a class="header" href="#miscellaneous">Miscellaneous</a></h2>
<h3 id="transaction-timestamps"><a class="header" href="#transaction-timestamps">Transaction timestamps</a></h3>
<p>Since transaction timestamps – whether they are signed or not – do not provide any guarantee of correctness, they have been left out of the <em>Transaction Payload</em>. Instead, the global timestamp of the confirming milestone (<a href="../TIP-0008/tip-0008.html">TIP-8</a>) is used.</p>
<h3 id="address-reuse"><a class="header" href="#address-reuse">Address reuse</a></h3>
<p>While, in contrast to Winternitz one-time signatures (W-OTS), producing multiple Ed25519 signatures for the same private key and address does not decrease its security, it still drastically reduces the privacy of users. It is thus considered best practice that applications and services create a new address per deposit to circumvent these privacy issues.</p>
<p>In essence, Ed25519 support allows for smaller transaction sizes and to safely spend funds which were sent to an already used deposit address. Ed25519 addresses are not meant to be used like email addresses. See this <a href="https://en.bitcoin.it/wiki/Address_reuse">Bitcoin wiki article</a> for further information.</p>
<h1 id="drawbacks"><a class="header" href="#drawbacks">Drawbacks</a></h1>
<ul>
<li>The new transaction format is the core data type within the IOTA ecosystem. Changing it means that all projects need to accommodate it, including wallets, web services, client libraries and applications using IOTA in general. It is not possible to keep these changes backwards compatible, meaning that all nodes must upgrade to further participate in the network.</li>
<li>It is not possible to produce a valid transaction without having access to the content of the consumed outputs.</li>
</ul>
<h1 id="rationale-and-alternatives"><a class="header" href="#rationale-and-alternatives">Rationale and alternatives</a></h1>
<ul>
<li><em>Inputs Commitment</em> and <em>Network ID</em> are both explicit fields of the transaction, while they could be made configuration
parameters for the signature generating process. In this scenario the signature would be invalid if the parameters on client
and network side mismatch. While this would reduce the size of a transaction, it would make it impossible to debug the
reason for having an invalid signature and transaction. With the current solution we intend to optimize for ease of development.</li>
<li>Uniqueness of all inputs is kept as it prevents introducing double spends in the same transaction.</li>
</ul>
<h1 id="copyright"><a class="header" href="#copyright">Copyright</a></h1>
<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../tips/TIP-0019/tip-0019.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../tips/TIP-0021/tip-0021.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../tips/TIP-0019/tip-0019.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../tips/TIP-0021/tip-0021.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
